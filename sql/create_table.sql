CREATE TABLE CLIENT
(
    ID_CLIENT            NUMBER(19) GENERATED BY DEFAULT AS IDENTITY,
    LAST_NAME            NVARCHAR2(50) NOT NULL,
    FIRST_NAME           NVARCHAR2(50) NOT NULL,
    MIDDLE_NAME          NVARCHAR2(50) NOT NULL,
    BIRTHDAY             DATE NOT NULL,
    PASSPORT_NUMBER      NVARCHAR2(10) NOT NULL,
    ADDRESS_REGISTRATION NVARCHAR2 (200) NOT NULL,
    ADDRESS_RESIDENTIAL  NVARCHAR2 (200),
    MOBILE_PHONE         NVARCHAR2(11) NOT NULL,
    EMAIL                NVARCHAR2(100),
    PRIMARY KEY (ID_CLIENT)
);

CREATE INDEX INDX_CLIENT_01 ON CLIENT (LAST_NAME, FIRST_NAME, MIDDLE_NAME);
CREATE INDEX INDX_CLIENT_02 ON CLIENT (PASSPORT_NUMBER);

CREATE TABLE ACCOUNT
(
    ID_ACCOUNT     NUMBER(19) GENERATED BY DEFAULT AS IDENTITY,
    ID_CLIENT      NUMBER(19) NOT NULL,
    TYPE_ACCOUNT   NVARCHAR2(50) NOT NULL,
    ACCOUNT_NUMBER NVARCHAR2(30) NOT NULL,
    PRIMARY KEY (ID_ACCOUNT),
    FOREIGN KEY (ID_CLIENT) REFERENCES CLIENT (ID_CLIENT)
);
CREATE UNIQUE INDEX INDX_ACCOUNT_01 ON ACCOUNT (ACCOUNT_NUMBER);


CREATE TABLE ACCOUNT_BALANCE
(
    ID_ACCOUNT NUMBER(19) NOT NULL,
    CURRENCY   NVARCHAR2(20) NOT NULL,
    MONEY      DECIMAL NOT NULL,
    FOREIGN KEY (ID_ACCOUNT) REFERENCES ACCOUNT (ID_ACCOUNT)
);


CREATE TABLE APPLICATION
(
    ID_APP        NUMBER(19) GENERATED BY DEFAULT AS IDENTITY,
    ID_CLIENT     NUMBER(19) NOT NULL,
    FROM_ACCOUNT  NUMBER(19) NOT NULL,
    TO_ACCOUNT    NUMBER(19) NOT NULL,
    MONEY         DECIMAL NOT NULL,
    CREATION_DATE DATE    NOT NULL,
    ID_REGULAR    NUMBER(19),
    PRIMARY KEY (ID_APP),
    FOREIGN KEY (ID_CLIENT) REFERENCES CLIENT (ID_CLIENT),
    FOREIGN KEY (FROM_ACCOUNT) REFERENCES ACCOUNT (ID_ACCOUNT),
    FOREIGN KEY (TO_ACCOUNT) REFERENCES ACCOUNT (ID_ACCOUNT)
);

CREATE INDEX INDX_APPLICATION_01 ON APPLICATION (FROM_ACCOUNT);
CREATE INDEX INDX_APPLICATION_02 ON APPLICATION (CREATION_DATE);


CREATE TABLE TRANSACTION
(
    ID_TRANSACTION NUMBER(19) GENERATED BY DEFAULT AS IDENTITY,
    FROM_ACCOUNT   NUMBER(19) NOT NULL,
    TO_ACCOUNT     NUMBER(19) NOT NULL,
    STATUS         NVARCHAR2(20) NOT NULL,
    DATE_EXECUTION DATE NOT NULL,
    PRIMARY KEY (ID_TRANSACTION),
    FOREIGN KEY (FROM_ACCOUNT) REFERENCES ACCOUNT (ID_ACCOUNT),
    FOREIGN KEY (TO_ACCOUNT) REFERENCES ACCOUNT (ID_ACCOUNT)
);

CREATE TABLE PAYMENT
(
    ID_PAYMENT     NUMBER(19) GENERATED BY DEFAULT AS IDENTITY,
    ID_APP         NUMBER(19) NOT NULL,
    ID_TRANSACTION NUMBER(19) NOT NULL,
    MONEY          DECIMAL NOT NULL,
    PAYMENT_STATUS NVARCHAR2(20) NOT NULL,
    PRIMARY KEY (ID_PAYMENT),
    FOREIGN KEY (ID_APP) REFERENCES APPLICATION (ID_APP),
    FOREIGN KEY (ID_TRANSACTION) REFERENCES TRANSACTION (ID_TRANSACTION),
    CONSTRAINT TRANSACTION UNIQUE (ID_TRANSACTION)
);

CREATE INDEX INDX_PAYMENT_01 ON PAYMENT (ID_APP);


CREATE TABLE REGULAR_PAYMENT
(
    ID_REGULAR NUMBER(19) GENERATED BY DEFAULT AS IDENTITY,
    ID_PAYMENT NUMBER(19) NOT NULL,
    DAY        NUMBER(2) NOT NULL,
    NEED       NVARCHAR2(20) NOT NULL,
    PRIMARY KEY (ID_REGULAR),
    FOREIGN KEY (ID_PAYMENT) REFERENCES PAYMENT (ID_PAYMENT)
);


CREATE TABLE AUDIT_PAY
(
    ID_AUDIT_PAY NUMBER(19) GENERATED BY DEFAULT AS IDENTITY,
    ID_PAYMENT   NUMBER(19) NOT NULL,
    STATUS       NVARCHAR2(20) NOT NULL,
    PRIMARY KEY (ID_AUDIT_PAY),
    FOREIGN KEY (ID_PAYMENT) REFERENCES PAYMENT (ID_PAYMENT)
);

ALTER TABLE APPLICATION
    ADD CONSTRAINT FK_APPLICATION_REGULAR_PAYMENT_01
        FOREIGN KEY (ID_REGULAR)
            REFERENCES REGULAR_PAYMENT (ID_REGULAR);
